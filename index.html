<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Logística Lake - Inventario Nexxus</title>
    
    <!-- 1. Cargar Tailwind CSS y Configuración -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        lake: {
                            light: '#EFEEE9',
                            dark: '#1C1917',
                        }
                    },
                    animation: {
                        'spin-slow': 'spin 8s linear infinite',
                    }
                }
            }
        }
    </script>
    
    <!-- 2. Cargar Librería XLSX -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx-js-style@1.2.0/dist/xlsx.bundle.js"></script>

    <style>
        body { font-family: system-ui, -apple-system, sans-serif; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* --- SISTEMA DE ANIMACIONES COZY --- */
        
        /* Entradas */
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes scaleIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        
        /* Salidas (Nuevas) */
        @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; } }
        @keyframes scaleOut { from { opacity: 1; transform: scale(1); } to { opacity: 0; transform: scale(0.95); } }
        @keyframes slideDownOut { from { opacity: 1; transform: translateY(0); } to { opacity: 0; transform: translateY(20px); } }

        /* Clases de utilidad */
        .animate-fade-in { animation: fadeIn 0.5s ease-out forwards; }
        .animate-slide-up { animation: slideUp 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards; opacity: 0; } 
        .animate-scale-in { animation: scaleIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) forwards; }
        
        /* Clases de Salida */
        .animate-fade-out { animation: fadeOut 0.3s ease-in forwards; }
        .animate-scale-out { animation: scaleOut 0.3s cubic-bezier(0.34, 1.56, 0.64, 1) forwards; }
        .animate-slide-out { animation: slideDownOut 0.3s ease-in forwards; }

        /* Retrasos */
        .delay-0 { animation-delay: 0ms; }
        .delay-100 { animation-delay: 100ms; }
    </style>
</head>
<body class="bg-lake-light dark:bg-lake-dark text-stone-600 dark:text-stone-300 selection:bg-indigo-100 selection:text-indigo-900 transition-colors duration-500">
    <div id="root"></div>

    <script type="module">
        import React, { useState, useEffect, useRef } from 'https://esm.sh/react@18.2.0';
        import { createRoot } from 'https://esm.sh/react-dom@18.2.0/client';
        import { 
            Truck, ClipboardList, Save, X, Download, Upload, 
            AlertTriangle, CheckCircle, MoreHorizontal, Box, 
            Wifi, WifiOff, ChevronDown, Sparkles, FileSpreadsheet, 
            Moon, Sun, Settings, Wrench
        } from 'https://esm.sh/lucide-react@0.263.1';

        // --- CONSTANTES ---
        const DOCK_COUNT = 18;
        const YARD_COUNT = 15; 
        const SHIFTS = [1, 2, 3];
        const STORAGE_KEY = 'lake_logistica_inventory_v13_animations_plus'; 

        const SIZES = ['53', '48', '40', '3.5']; 
        const DOCK_STATUSES = ['Vacía', 'Enrampada', 'Frenteada', 'Cargada']; 
        const YARD_STATUSES = ['Vacía', 'Cargada'];

        const emptySlotData = {
            id: '', number: 0, type: 'docks', size: '', eco: '', line: '',
            status: 'Vacía', sealLeft: '', sealRight: '', observations: '', updatedAt: null,
        };

        const generateInitialData = () => ({
            1: { docks: Array(DOCK_COUNT).fill(null).map((_, i) => ({ ...emptySlotData, id: `D1-${i+1}`, number: i+1, type: 'docks' })), yard: Array(YARD_COUNT).fill(null).map((_, i) => ({ ...emptySlotData, id: `Y1-${i+1}`, number: i+1, type: 'yard' })) },
            2: { docks: Array(DOCK_COUNT).fill(null).map((_, i) => ({ ...emptySlotData, id: `D2-${i+1}`, number: i+1, type: 'docks' })), yard: Array(YARD_COUNT).fill(null).map((_, i) => ({ ...emptySlotData, id: `Y2-${i+1}`, number: i+1, type: 'yard' })) },
            3: { docks: Array(DOCK_COUNT).fill(null).map((_, i) => ({ ...emptySlotData, id: `D3-${i+1}`, number: i+1, type: 'docks' })), yard: Array(YARD_COUNT).fill(null).map((_, i) => ({ ...emptySlotData, id: `Y3-${i+1}`, number: i+1, type: 'yard' })) },
        });

        const DEFAULT_INVENTORY = generateInitialData();

        // --- COMPONENTE TARJETA ---
        const SlotCard = ({ data, onClick, index, type }) => {
            const statusNorm = (data.status || '').toLowerCase().replace('.', '').trim();
            const isOccupied = statusNorm !== 'vacía' && statusNorm !== '';
            
            let cardStyle = "bg-white dark:bg-stone-800 border-2 border-transparent dark:border-stone-700/50 shadow-sm hover:border-indigo-200 dark:hover:border-indigo-500/30 text-stone-400 dark:text-stone-500 hover:shadow-xl hover:shadow-indigo-200/50 dark:hover:shadow-black/40";
            let iconColor = "text-stone-300 dark:text-stone-600";
            let statusBadge = "bg-stone-100 dark:bg-stone-700 text-stone-500 dark:text-stone-400 border border-stone-200 dark:border-stone-600";

            if (statusNorm === 'cargada') {
                cardStyle = "bg-white dark:bg-rose-900/10 border-2 border-rose-100 dark:border-rose-900/30 text-rose-700 dark:text-rose-400 hover:shadow-xl hover:shadow-rose-200/50 dark:hover:shadow-rose-900/20";
                iconColor = "text-rose-400 dark:text-rose-500";
                statusBadge = "bg-rose-50 dark:bg-rose-900/30 text-rose-600 dark:text-rose-300 border border-rose-100 dark:border-rose-800/50";
            }
            if (statusNorm === 'frenteada') {
                cardStyle = "bg-white dark:bg-amber-900/10 border-2 border-amber-100 dark:border-amber-900/30 text-amber-700 dark:text-amber-400 hover:shadow-xl hover:shadow-amber-200/50 dark:hover:shadow-amber-900/20";
                iconColor = "text-amber-400 dark:text-amber-500";
                statusBadge = "bg-amber-50 dark:bg-amber-900/30 text-amber-600 dark:text-amber-300 border border-amber-100 dark:border-amber-800/50";
            }
            if (statusNorm === 'enrampada') {
                cardStyle = "bg-white dark:bg-sky-900/10 border-2 border-sky-100 dark:border-sky-900/30 text-sky-700 dark:text-sky-400 hover:shadow-xl hover:shadow-sky-200/50 dark:hover:shadow-sky-900/20";
                iconColor = "text-sky-400 dark:text-sky-500";
                statusBadge = "bg-sky-50 dark:bg-sky-900/30 text-sky-600 dark:text-sky-300 border border-sky-100 dark:border-sky-800/50";
            }
            if (statusNorm === 'vacía' && (data.eco || data.line)) {
                cardStyle = "bg-white dark:bg-emerald-900/10 border-2 border-emerald-100 dark:border-emerald-900/30 text-emerald-700 dark:text-emerald-400 hover:shadow-xl hover:shadow-emerald-200/50 dark:hover:shadow-emerald-900/20";
                iconColor = "text-emerald-400 dark:text-emerald-500";
                statusBadge = "bg-emerald-50 dark:bg-emerald-900/30 text-emerald-500 dark:text-emerald-300 border border-emerald-100 dark:border-emerald-800/50";
            }

            const delayStyle = { animationDelay: `${(index % 10) * 50}ms` };

            let ecoText = 'Disponible';
            if (data.eco) ecoText = `ECO ${data.eco}`;
            else if (isOccupied) ecoText = 'Sin económico';

            return React.createElement('div', {
                style: delayStyle,
                onClick: () => onClick(index, type),
                className: `
                    relative p-5 rounded-[1.8rem] transition-all duration-500 ease-out cursor-pointer 
                    active:scale-95 flex flex-col justify-between h-44 group animate-slide-up
                    ${cardStyle}
                ` 
            }, [
                React.createElement('div', { key: 'header', className: "flex justify-between items-start" }, [
                    React.createElement('div', { key: 'info', className: "flex flex-col" }, [
                        React.createElement('span', { key: 'num', className: "font-black text-3xl tracking-tighter opacity-90 transition-transform group-hover:scale-105 origin-left text-stone-700 dark:text-stone-200" }, type === 'docks' ? `${data.number}` : `P${data.number}`),
                        React.createElement('span', { key: 'label', className: "text-[10px] uppercase tracking-widest font-bold opacity-50 mt-1" }, type === 'docks' ? 'Andén' : 'Patio')
                    ]),
                    isOccupied 
                        ? React.createElement('div', { key: 'icon', className: `p-2.5 rounded-2xl bg-stone-50 dark:bg-stone-900/50 shadow-inner ${iconColor} transition-transform group-hover:rotate-3 group-hover:scale-110 duration-300` }, React.createElement(Truck, { size: 22, strokeWidth: 1.5 }))
                        : React.createElement('div', { key: 'icon', className: `p-2.5 rounded-2xl bg-stone-50 dark:bg-stone-900/50 ${iconColor} transition-transform group-hover:scale-110 duration-300` }, React.createElement(Box, { size: 22, strokeWidth: 1.5 }))
                ]),
                React.createElement('div', { key: 'details', className: "space-y-1.5" }, [
                    React.createElement('div', { key: 'eco', className: "text-base font-bold truncate opacity-90 dark:opacity-100" }, ecoText),
                    data.line && React.createElement('div', { key: 'line', className: "text-xs font-bold uppercase truncate opacity-60 dark:opacity-70 flex items-center gap-1.5" }, [
                         React.createElement('span', { className: "w-1.5 h-1.5 rounded-full bg-current opacity-40" }),
                         data.line
                    ]),
                    React.createElement('div', { key: 'status', className: `text-[10px] font-extrabold px-3 py-1.5 rounded-full w-fit tracking-wide transition-all duration-300 ${statusBadge} mt-2` }, (data.status || 'Sin Asignar').toUpperCase())
                ]),
                (statusNorm === 'cargada' || statusNorm === 'frenteada') && React.createElement('div', { key: 'alert', className: "absolute top-3 right-3 md:top-auto md:bottom-4 md:right-4 transition-all duration-300 group-hover:scale-125 group-hover:-rotate-12" }, 
                    data.sealRight 
                        ? React.createElement(CheckCircle, { size: 20, className: "text-emerald-500 fill-emerald-50" }) 
                        : React.createElement(AlertTriangle, { size: 20, className: "text-rose-500 fill-rose-50" })
                )
            ]);
        };

        // --- APP PRINCIPAL ---
        function App() {
            const [inventory, setInventory] = useState(() => {
                try {
                    if (typeof window !== 'undefined' && window.localStorage) {
                        const savedData = localStorage.getItem(STORAGE_KEY);
                        if (savedData) return JSON.parse(savedData);
                    }
                } catch (error) { console.error(error); }
                return DEFAULT_INVENTORY;
            });

            const [isDarkMode, setIsDarkMode] = useState(false);
            
            // ESTADOS DE UI CON LÓGICA DE CIERRE (ANIMACIÓN DE SALIDA)
            const [settingsOpen, setSettingsOpen] = useState(false);
            const [isClosingSettings, setIsClosingSettings] = useState(false);

            const [currentShift, setCurrentShift] = useState(1);
            const [activeTab, setActiveTab] = useState('docks'); 
            
            const [modalOpen, setModalOpen] = useState(false);
            const [isClosingModal, setIsClosingModal] = useState(false);

            const [editingSlot, setEditingSlot] = useState(null);
            const [formData, setFormData] = useState(emptySlotData);
            const fileInputRef = useRef(null);
            const [isOnline, setIsOnline] = useState(navigator.onLine);
            
            // Toast con estado de cierre
            const [showSaveToast, setShowSaveToast] = useState(false);
            const [isClosingToast, setIsClosingToast] = useState(false);

            useEffect(() => { try { if (window.localStorage) localStorage.setItem(STORAGE_KEY, JSON.stringify(inventory)); } catch (e) {} }, [inventory]);
            useEffect(() => {
                const handleState = () => setIsOnline(navigator.onLine);
                window.addEventListener('online', handleState); window.addEventListener('offline', handleState);
                return () => { window.removeEventListener('online', handleState); window.removeEventListener('offline', handleState); }
            }, []);

            const toggleTheme = () => {
                const html = document.documentElement;
                if (html.classList.contains('dark')) {
                    html.classList.remove('dark');
                    setIsDarkMode(false);
                } else {
                    html.classList.add('dark');
                    setIsDarkMode(true);
                }
            };

            // Lógica para cerrar modales con animación
            const closeModalAnimated = () => {
                setIsClosingModal(true);
                setTimeout(() => {
                    setModalOpen(false);
                    setIsClosingModal(false);
                }, 280); // Tiempos sincronizados con CSS animation duration
            };

            const closeSettingsAnimated = () => {
                setIsClosingSettings(true);
                setTimeout(() => {
                    setSettingsOpen(false);
                    setIsClosingSettings(false);
                }, 280);
            };

            const triggerSaveFeedback = () => { 
                setShowSaveToast(true); 
                setIsClosingToast(false);
                setTimeout(() => {
                    setIsClosingToast(true);
                    setTimeout(() => {
                        setShowSaveToast(false);
                        setIsClosingToast(false);
                    }, 300); // Esperar animación de salida
                }, 2000); 
            };

            const handleSlotClick = (index, type) => {
                const data = inventory[currentShift][type][index];
                setEditingSlot({ index, type });
                setFormData({ ...data });
                setModalOpen(true);
            };
            const handleInputChange = (e) => {
                const { name, value } = e.target;
                setFormData(prev => ({ ...prev, [name]: value }));
            };
            const validateForm = () => {
                const statusNorm = (formData.status || '').toLowerCase();
                if ((statusNorm === 'frenteada' || statusNorm === 'cargada') && !formData.sealRight) {
                    alert("⚠️ ¡Atención Lake!\n\nEl Sello Derecho (#2) es obligatorio."); return false;
                } return true;
            };
            const handleSave = () => {
                if (!validateForm()) return;
                const updatedData = { ...formData, updatedAt: new Date().toISOString() };
                const newInventory = JSON.parse(JSON.stringify(inventory));
                newInventory[currentShift][editingSlot.type][editingSlot.index] = updatedData;
                setInventory(newInventory);
                closeModalAnimated(); // Usar cierre animado
                triggerSaveFeedback();
            };
            const handleClearSlot = () => {
                if(!window.confirm("¿Liberar este espacio?")) return;
                const newInventory = JSON.parse(JSON.stringify(inventory));
                const originalId = newInventory[currentShift][editingSlot.type][editingSlot.index].id;
                newInventory[currentShift][editingSlot.type][editingSlot.index] = { ...emptySlotData, id: originalId, number: formData.number, type: editingSlot.type };
                setInventory(newInventory);
                closeModalAnimated(); // Usar cierre animado
                triggerSaveFeedback();
            };
            const handleResetAll = () => {
                if(window.confirm("⚠️ ¿Reiniciar todo?")) {
                    setInventory(DEFAULT_INVENTORY);
                    try { localStorage.removeItem(STORAGE_KEY); } catch (e) {}
                }
            }

            // Export/Import
            const exportToExcel = () => {
                if (!window.XLSX) return alert("Cargando...");
                const wb = XLSX.utils.book_new();
                const borderStyle = { top: { style: "thin" }, bottom: { style: "thin" }, left: { style: "thin" }, right: { style: "thin" } };
                const titleStyle = { font: { bold: true, sz: 14, name: "Calibri" }, alignment: { horizontal: "left" } };
                const headerStyle = { font: { bold: true, sz: 11, name: "Calibri" }, fill: { fgColor: { rgb: "E0E0E0" } }, border: borderStyle, alignment: { horizontal: "center", vertical: "center" } };
                const dataStyle = { font: { sz: 11, name: "Calibri" }, border: borderStyle, alignment: { horizontal: "center", vertical: "center" } };
                const separatorStyle = { font: { bold: true, sz: 11, name: "Calibri" } };
                const currentData = inventory[currentShift];
                const wsData = [[{ v: "Inventario Nexxus", s: titleStyle }]];
                wsData.push(["Ubicación", "FT", "Eco.", "Línea", "Sello #1", "Sello #2", "Status", "Observaciones"].map(h => ({ v: h, s: headerStyle })));
                currentData.docks.forEach(slot => {
                    const isFrenteada = (slot.status || '').toLowerCase() === 'frenteada';
                    const show = !isFrenteada;
                    wsData.push([{ v: `Andén ${slot.number}`, s: dataStyle }, { v: show ? slot.size : '', s: dataStyle }, { v: show ? slot.eco : '', s: dataStyle }, { v: show ? slot.line : '', s: dataStyle }, { v: show ? slot.sealLeft : '', s: dataStyle }, { v: show ? slot.sealRight : '', s: dataStyle }, { v: show && slot.status !== 'Vacía' ? (slot.status + '.') : '', s: dataStyle }, { v: show ? slot.observations : '', s: dataStyle }]);
                });
                const sepRow = new Array(8).fill({ v: "", s: {} }); sepRow[1] = { v: "Frenteada", s: separatorStyle }; wsData.push(sepRow);
                currentData.docks.forEach(slot => {
                    const isFrenteada = (slot.status || '').toLowerCase() === 'frenteada';
                    wsData.push([{ v: `Frenteada ${slot.number}`, s: dataStyle }, { v: isFrenteada ? slot.size : '', s: dataStyle }, { v: isFrenteada ? slot.eco : '', s: dataStyle }, { v: isFrenteada ? slot.line : '', s: dataStyle }, { v: isFrenteada ? slot.sealLeft : '', s: dataStyle }, { v: isFrenteada ? slot.sealRight : '', s: dataStyle }, { v: isFrenteada ? (slot.status + '.') : '', s: dataStyle }, { v: isFrenteada ? slot.observations : '', s: dataStyle }]);
                });
                const sepRow2 = new Array(8).fill({ v: "", s: {} }); sepRow2[1] = { v: "Patio", s: separatorStyle }; wsData.push(sepRow2);
                currentData.yard.forEach(slot => {
                    wsData.push([{ v: `Patio ${slot.number}`, s: dataStyle }, { v: slot.size, s: dataStyle }, { v: slot.eco, s: dataStyle }, { v: slot.line, s: dataStyle }, { v: slot.sealLeft, s: dataStyle }, { v: slot.sealRight, s: dataStyle }, { v: slot.status !== 'Vacía' ? (slot.status + '.') : '', s: dataStyle }, { v: slot.observations, s: dataStyle }]);
                });
                const ws = XLSX.utils.aoa_to_sheet(wsData);
                ws['!cols'] = [{ wch: 15 }, { wch: 6 }, { wch: 12 }, { wch: 15 }, { wch: 12 }, { wch: 12 }, { wch: 15 }, { wch: 30 }];
                XLSX.utils.book_append_sheet(wb, ws, "Inventario");
                XLSX.writeFile(wb, `Inventario Nexxus - ${new Date().toLocaleDateString('es-MX', { day: 'numeric', month: 'long' })}.xlsx`);
            };

            const handleImportClick = () => fileInputRef.current.click();
            const handleFileChange = (e) => {
                const file = e.target.files[0]; if (!file) return; const reader = new FileReader();
                reader.onload = (evt) => {
                    try {
                        const wb = XLSX.read(evt.target.result, { type: 'binary' });
                        const data = XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]], { header: "A", defval: "" });
                        const newInventory = JSON.parse(JSON.stringify(inventory));
                        let count = 0;
                        const resolveStatus = (raw, s1, s2, eco, allowed) => {
                            let c = raw.toString().replace(/\.$/, '').trim(); if(c) c = c.charAt(0).toUpperCase() + c.slice(1).toLowerCase();
                            if(allowed.includes(c)) return c; if(s1||s2) return 'Cargada'; if(eco && allowed.includes('Cargada')) return 'Cargada'; return 'Vacía';
                        };
                        data.forEach(r => {
                            const u = (r['A']||'').toString().trim().toLowerCase(); if(!u) return;
                            const s1=(r['E']||'').toString(), s2=(r['F']||'').toString(), eco=(r['C']||'').toString();
                            const common = { size: (r['B']||'').toString(), eco, line: (r['D']||'').toString(), sealLeft: s1, sealRight: s2, observations: (r['H']||'').toString() };
                            if(u.startsWith('andén')) {
                                const n = parseInt(u.replace(/[^0-9]/g, '')); if(n>0 && n<=DOCK_COUNT) {
                                    newInventory[currentShift].docks[n-1] = { ...newInventory[currentShift].docks[n-1], ...common, status: resolveStatus(r['G'], s1, s2, eco, DOCK_STATUSES) }; count++;
                                }
                            } else if(u.startsWith('frenteada')) {
                                const n = parseInt(u.replace(/[^0-9]/g, '')); if(n>0 && n<=DOCK_COUNT) {
                                    if(eco||s1||s2||r['G']) { newInventory[currentShift].docks[n-1] = { ...newInventory[currentShift].docks[n-1], ...common, status: 'Frenteada' }; count++; }
                                }
                            } else if(u.startsWith('patio')) {
                                const n = parseInt(u.replace(/[^0-9]/g, '')); if(n>0 && n<=YARD_COUNT) {
                                    newInventory[currentShift].yard[n-1] = { ...newInventory[currentShift].yard[n-1], ...common, status: resolveStatus(r['G'], s1, s2, eco, YARD_STATUSES) }; count++;
                                }
                            }
                        });
                        setInventory(newInventory); alert(`✅ ${count} registros importados.`); triggerSaveFeedback();
                    } catch(e) { alert("❌ Error archivo"); }
                }; reader.readAsBinaryString(file); e.target.value = '';
            };

            const currentDocks = inventory[currentShift].docks;
            const currentYard = inventory[currentShift].yard;

            // ESTILOS DE INPUT
            const inputClass = "w-full px-5 py-4 bg-stone-100/50 dark:bg-stone-900 hover:bg-stone-100 dark:hover:bg-stone-800 focus:bg-white dark:focus:bg-stone-950 border border-stone-200 dark:border-stone-700 rounded-2xl text-stone-700 dark:text-stone-200 font-bold ring-4 ring-transparent focus:ring-indigo-100 dark:focus:ring-indigo-900/30 outline-none transition-all placeholder:text-stone-300 dark:placeholder:text-stone-600";
            const selectClass = "w-full px-5 py-4 bg-stone-100/50 dark:bg-stone-900 hover:bg-stone-100 dark:hover:bg-stone-800 focus:bg-white dark:focus:bg-stone-950 border border-stone-200 dark:border-stone-700 rounded-2xl text-stone-700 dark:text-stone-200 font-bold ring-4 ring-transparent focus:ring-indigo-100 dark:focus:ring-indigo-900/30 outline-none appearance-none cursor-pointer transition-all pr-12";

            return React.createElement('div', { className: "min-h-screen pb-32 animate-fade-in" }, [
                
                // TOAST DE GUARDADO (CON ANIMACIÓN DE SALIDA)
                showSaveToast && React.createElement('div', { className: `fixed bottom-6 left-1/2 -translate-x-1/2 z-50 bg-stone-800 dark:bg-stone-200 text-white dark:text-stone-900 px-6 py-3 rounded-full shadow-xl flex items-center gap-2 ${isClosingToast ? 'animate-slide-out' : 'animate-scale-in'}` }, [ React.createElement(CheckCircle, { size: 20, className: "text-emerald-400 dark:text-emerald-600" }), React.createElement('span', { className: "font-bold text-sm" }, "Guardado") ]),

                React.createElement('header', { className: "sticky top-4 z-40 px-4 mb-8" }, 
                    React.createElement('div', { className: "max-w-6xl mx-auto bg-white/80 dark:bg-stone-900/80 backdrop-blur-xl shadow-lg rounded-[2.5rem] border border-white/50 dark:border-stone-700/50 px-6 py-4 animate-scale-in delay-0 transition-colors duration-500" }, [
                        React.createElement('div', { className: "flex flex-col md:flex-row md:items-center justify-between gap-4" }, [
                            React.createElement('div', { className: "flex items-center gap-3" }, [
                                React.createElement('div', { onClick: handleResetAll, className: "bg-indigo-600 cursor-pointer hover:bg-indigo-700 text-white p-3 rounded-2xl shadow-lg shadow-indigo-200 dark:shadow-indigo-900/50" }, React.createElement(ClipboardList, { size: 24 })),
                                React.createElement('div', null, [
                                    React.createElement('h1', { className: "text-xl font-bold text-stone-800 dark:text-stone-100 tracking-tight flex items-center gap-2" }, ["Logística Lake", !isOnline && React.createElement('span', { className: "flex items-center gap-1 text-[10px] bg-rose-100 text-rose-600 px-2 py-0.5 rounded-full animate-pulse" }, [React.createElement(WifiOff, { size: 10 }), " Offline"])]),
                                    React.createElement('p', { className: "text-xs font-medium text-stone-400 dark:text-stone-500" }, isOnline ? 'Modo Nexxus Activo' : 'Modo Local')
                                ])
                            ]),
                            React.createElement('div', { className: "flex items-center gap-3 bg-stone-100 dark:bg-stone-800 p-1.5 rounded-[1.5rem]" },
                                SHIFTS.map(shift => React.createElement('button', { key: shift, onClick: () => setCurrentShift(shift), className: `px-5 py-2.5 rounded-2xl text-sm font-bold transition-all duration-300 ${currentShift === shift ? 'bg-white dark:bg-stone-700 text-indigo-600 dark:text-indigo-300 shadow-md' : 'text-stone-400 dark:text-stone-500 hover:text-stone-600 dark:hover:text-stone-300'}` }, `T${shift}`))
                            ),
                            React.createElement('div', { className: "flex gap-2 items-center" }, [
                                React.createElement('button', { onClick: toggleTheme, className: "p-3 rounded-2xl bg-amber-100 dark:bg-indigo-900/30 text-amber-600 dark:text-indigo-300 hover:scale-105 transition-all", title: "Cambiar Tema" }, isDarkMode ? React.createElement(Moon, { size: 20 }) : React.createElement(Sun, { size: 20 })),
                                React.createElement('button', { onClick: handleImportClick, className: "p-3 rounded-2xl bg-stone-100 dark:bg-stone-800 hover:bg-stone-200 dark:hover:bg-stone-700 text-stone-600 dark:text-stone-300 transition-all", title: "Importar" }, [React.createElement(Upload, { size: 20 }), React.createElement('input', { type: "file", accept: ".xlsx,.csv", ref: fileInputRef, onChange: handleFileChange, className: "hidden" })]),
                                React.createElement('button', { onClick: exportToExcel, className: "p-3 rounded-2xl bg-green-600 hover:bg-green-700 text-white shadow-lg shadow-green-200 dark:shadow-green-900/40 transition-all", title: "Exportar" }, React.createElement(FileSpreadsheet, { size: 20 })),
                                React.createElement('button', { onClick: () => setSettingsOpen(true), className: "p-3 rounded-2xl bg-stone-200 dark:bg-stone-700 hover:bg-stone-300 dark:hover:bg-stone-600 text-stone-600 dark:text-stone-300 transition-all", title: "Configuración" }, React.createElement(Settings, { size: 20 }))
                            ])
                        ]),
                        React.createElement('div', { className: "flex gap-3 mt-6 overflow-x-auto pb-1 md:pb-0 no-scrollbar" }, [
                            React.createElement('button', { onClick: () => setActiveTab('docks'), className: `px-6 py-3 rounded-2xl text-sm font-bold whitespace-nowrap transition-all ${activeTab === 'docks' ? 'bg-stone-800 dark:bg-stone-200 text-white dark:text-stone-900 shadow-lg' : 'bg-transparent text-stone-400 hover:bg-stone-100 dark:hover:bg-stone-800'}` }, "Andenes (18)"),
                            React.createElement('button', { onClick: () => setActiveTab('yard'), className: `px-6 py-3 rounded-2xl text-sm font-bold whitespace-nowrap transition-all ${activeTab === 'yard' ? 'bg-stone-800 dark:bg-stone-200 text-white dark:text-stone-900 shadow-lg' : 'bg-transparent text-stone-400 hover:bg-stone-100 dark:hover:bg-stone-800'}` }, "Patio de Maniobras (15)")
                        ])
                    ])
                ),

                React.createElement('main', { className: "max-w-6xl mx-auto px-6" }, 
                    // USAMOS KEY PARA FORZAR LA RE-ANIMACIÓN AL CAMBIAR DE PESTAÑA
                    activeTab === 'docks' ? React.createElement('div', { key: 'docks-view', className: "space-y-12 animate-fade-in" }, [
                        React.createElement('section', { className: "animate-slide-up" }, [
                            React.createElement('div', { className: "flex items-center gap-3 mb-6 px-2" }, [ React.createElement('span', { className: "flex items-center justify-center w-10 h-10 rounded-2xl bg-orange-100 dark:bg-orange-900/30 text-orange-600 dark:text-orange-300 font-bold text-base shadow-sm" }, "G"), React.createElement('h2', { className: "text-2xl font-bold text-stone-700 dark:text-stone-200 tracking-tight" }, "Zona Galleta") ]),
                            React.createElement('div', { className: "grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-5" }, currentDocks.slice(0, 10).map((slot, idx) => React.createElement(SlotCard, { key: slot.id, index: idx, type: "docks", data: slot, onClick: handleSlotClick })))
                        ]),
                        React.createElement('section', { className: "animate-slide-up delay-100" }, [
                            React.createElement('div', { className: "flex items-center gap-3 mb-6 px-2" }, [ React.createElement('span', { className: "flex items-center justify-center w-10 h-10 rounded-2xl bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-300 font-bold text-base shadow-sm" }, "S"), React.createElement('h2', { className: "text-2xl font-bold text-stone-700 dark:text-stone-200 tracking-tight" }, "Zona Salado") ]),
                            React.createElement('div', { className: "grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-5" }, currentDocks.slice(10, 18).map((slot, idx) => React.createElement(SlotCard, { key: slot.id, index: idx + 10, type: "docks", data: slot, onClick: handleSlotClick })))
                        ])
                    ]) : React.createElement('div', { key: 'yard-view', className: "animate-fade-in" }, [
                        React.createElement('div', { className: "flex items-center gap-3 mb-6 px-2" }, [ React.createElement('span', { className: "flex items-center justify-center w-10 h-10 rounded-2xl bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-300 font-bold text-base shadow-sm" }, "P"), React.createElement('h2', { className: "text-2xl font-bold text-stone-700 dark:text-stone-200 tracking-tight" }, "Patio de Maniobras") ]),
                        React.createElement('div', { className: "grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-5" }, currentYard.map((slot, idx) => React.createElement(SlotCard, { key: slot.id, index: idx, type: "yard", data: slot, onClick: handleSlotClick })))
                    ])
                ),

                // MODAL DE REGISTRO (Con animación de salida)
                modalOpen && React.createElement('div', { className: "fixed inset-0 z-50 flex items-center justify-center p-4" }, [
                    React.createElement('div', { className: `absolute inset-0 bg-stone-900/30 dark:bg-black/60 backdrop-blur-md transition-opacity ${isClosingModal ? 'animate-fade-out' : 'animate-fade-in'}`, onClick: closeModalAnimated }),
                    React.createElement('div', { className: `relative bg-white/95 dark:bg-stone-900/95 backdrop-blur-2xl rounded-[2.5rem] shadow-2xl w-full max-w-md overflow-hidden border border-white dark:border-stone-700 ${isClosingModal ? 'animate-scale-out' : 'animate-scale-in'}` }, [
                        React.createElement('div', { className: "px-8 pt-8 pb-4 flex justify-between items-start" }, [
                            React.createElement('div', null, [
                                React.createElement('h3', { className: "text-3xl font-bold text-stone-800 dark:text-stone-100 tracking-tight" }, [editingSlot.type === 'docks' ? 'Andén' : 'Patio', ' ', React.createElement('span', { className: "text-indigo-600 dark:text-indigo-400" }, formData.number)]),
                                React.createElement('p', { className: "text-sm font-medium text-stone-400 mt-1 flex items-center gap-1" }, [React.createElement(Sparkles, { size: 14 }), editingSlot.type === 'docks' ? (formData.number <= 10 ? 'Zona Galleta' : 'Zona Salado') : 'Patio General'])
                            ]),
                            React.createElement('button', { onClick: closeModalAnimated, className: "p-3 rounded-full hover:bg-stone-100 dark:hover:bg-stone-800 text-stone-400 transition-colors" }, React.createElement(X, { size: 24 }))
                        ]),
                        React.createElement('div', { className: "px-8 py-4 space-y-6 max-h-[60vh] overflow-y-auto no-scrollbar" }, [
                            React.createElement('div', { className: "grid grid-cols-2 gap-5" }, [
                                React.createElement('div', { className: "space-y-2 group" }, [ React.createElement('label', { className: "text-[11px] font-bold text-stone-400 uppercase tracking-wider ml-1" }, "Económico"), React.createElement('input', { type: "text", name: "eco", value: formData.eco, onChange: handleInputChange, placeholder: "---", className: inputClass }) ]),
                                React.createElement('div', { className: "space-y-2 group" }, [ React.createElement('label', { className: "text-[11px] font-bold text-stone-400 uppercase tracking-wider ml-1" }, "Línea"), React.createElement('input', { type: "text", name: "line", value: formData.line, onChange: handleInputChange, placeholder: "---", className: inputClass }) ])
                            ]),
                            React.createElement('div', { className: "grid grid-cols-2 gap-5" }, [
                                React.createElement('div', { className: "space-y-2" }, [
                                    React.createElement('label', { className: "text-[11px] font-bold text-stone-400 uppercase tracking-wider ml-1" }, "FT"),
                                    React.createElement('div', { className: "relative group" }, [
                                        React.createElement('select', { name: "size", value: formData.size, onChange: handleInputChange, className: selectClass }, [ React.createElement('option', { value: "" }, "---"), SIZES.map(s => React.createElement('option', { key: s, value: s }, s)) ]),
                                        React.createElement('div', { className: "absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none text-stone-400 group-hover:text-indigo-500 transition-colors" }, React.createElement(ChevronDown, { size: 18 }))
                                    ])
                                ]),
                                React.createElement('div', { className: "space-y-2" }, [
                                    React.createElement('label', { className: "text-[11px] font-bold text-stone-400 uppercase tracking-wider ml-1" }, "Status"),
                                    React.createElement('div', { className: "relative group" }, [
                                        React.createElement('select', { name: "status", value: formData.status, onChange: handleInputChange, className: selectClass }, [ React.createElement('option', { value: "" }, "Seleccionar"), (editingSlot.type === 'docks' ? DOCK_STATUSES : YARD_STATUSES).map(s => React.createElement('option', { key: s, value: s }, s)) ]),
                                        React.createElement('div', { className: "absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none text-current opacity-50 group-hover:opacity-100 transition-opacity" }, React.createElement(ChevronDown, { size: 18 }))
                                    ])
                                ])
                            ]),
                            (formData.status === 'Frenteada' || formData.status === 'Cargada') && React.createElement('div', { className: "bg-[#FFF7ED] dark:bg-amber-900/10 p-6 rounded-[2rem] border border-orange-100 dark:border-amber-900/30 animate-slide-up" }, [
                                React.createElement('div', { className: "flex items-center gap-2 mb-4 text-orange-800 dark:text-amber-400 font-bold text-sm" }, [React.createElement(ClipboardList, { size: 18 }), " Sellos de Seguridad"]),
                                React.createElement('div', { className: "grid grid-cols-2 gap-4" }, [
                                    React.createElement('div', { className: "space-y-1" }, [ React.createElement('label', { className: "text-[10px] text-orange-600/70 dark:text-amber-400/70 font-bold uppercase ml-1" }, "Sello #1"), React.createElement('input', { type: "text", name: "sealLeft", value: formData.sealLeft, onChange: handleInputChange, className: "w-full p-3 bg-white dark:bg-stone-800 border border-orange-200 dark:border-amber-700/50 rounded-xl text-sm dark:text-stone-200 focus:outline-none focus:border-orange-400 ring-4 ring-transparent focus:ring-orange-100 dark:focus:ring-amber-900/20 transition-all" }) ]),
                                    React.createElement('div', { className: "space-y-1" }, [ React.createElement('label', { className: "text-[10px] text-orange-600/70 dark:text-amber-400/70 font-bold uppercase ml-1" }, "Sello #2 *"), React.createElement('input', { type: "text", name: "sealRight", value: formData.sealRight, onChange: handleInputChange, className: "w-full p-3 bg-white dark:bg-stone-800 border-2 border-orange-300 dark:border-amber-600/50 rounded-xl text-sm dark:text-stone-200 focus:outline-none focus:border-orange-500 ring-4 ring-transparent focus:ring-orange-100 dark:focus:ring-amber-900/20 font-medium transition-all", placeholder: "Requerido" }) ])
                                ])
                            ]),
                            React.createElement('div', { className: "space-y-2 group" }, [
                                React.createElement('label', { className: "text-[11px] font-bold text-stone-400 uppercase tracking-wider ml-1" }, "Observaciones"),
                                React.createElement('textarea', { name: "observations", value: formData.observations, onChange: handleInputChange, rows: 2, className: "w-full px-5 py-4 bg-stone-100/50 dark:bg-stone-900 hover:bg-stone-100 dark:hover:bg-stone-800 focus:bg-white dark:focus:bg-stone-950 border border-stone-200 dark:border-stone-700 rounded-2xl text-stone-700 dark:text-stone-200 font-medium ring-4 ring-transparent focus:ring-indigo-100 dark:focus:ring-indigo-900/30 outline-none resize-none placeholder:text-stone-300 transition-all", placeholder: "Notas adicionales..." })
                            ])
                        ]),
                        React.createElement('div', { className: "px-8 pb-8 pt-4 flex gap-3" }, [
                            React.createElement('button', { onClick: handleClearSlot, className: "flex-1 py-4 px-6 rounded-2xl bg-stone-100 dark:bg-stone-800 text-stone-500 dark:text-stone-400 font-bold hover:bg-rose-100 hover:text-rose-600 dark:hover:bg-rose-900/20 dark:hover:text-rose-300 transition-all duration-300 active:scale-95" }, "Limpiar"),
                            React.createElement('button', { onClick: handleSave, className: "flex-[2] py-4 px-6 rounded-2xl bg-stone-800 dark:bg-stone-200 text-white dark:text-stone-900 font-bold shadow-xl shadow-stone-300 dark:shadow-stone-900/50 hover:bg-stone-700 dark:hover:bg-white hover:-translate-y-1 transition-all duration-300 flex items-center justify-center gap-2 active:scale-95" }, [ React.createElement(Save, { size: 18 }), " Guardar Cambios" ])
                        ])
                    ])
                ]),

                // MODAL DE CONFIGURACIÓN (Settings) (Con animación de salida)
                settingsOpen && React.createElement('div', { className: "fixed inset-0 z-50 flex items-center justify-center p-4" }, [
                    React.createElement('div', { className: `absolute inset-0 bg-stone-900/30 dark:bg-black/60 backdrop-blur-md transition-opacity ${isClosingSettings ? 'animate-fade-out' : 'animate-fade-in'}`, onClick: closeSettingsAnimated }),
                    React.createElement('div', { className: `relative bg-white/95 dark:bg-stone-900/95 backdrop-blur-2xl rounded-[2.5rem] shadow-2xl p-10 w-full max-w-sm overflow-hidden border border-white dark:border-stone-700 text-center ${isClosingSettings ? 'animate-scale-out' : 'animate-scale-in'}` }, [
                        React.createElement('div', { className: "flex flex-col items-center gap-4" }, [
                            React.createElement('div', { className: "p-4 bg-indigo-50 dark:bg-indigo-900/20 rounded-full text-indigo-500 dark:text-indigo-400 animate-spin-slow" }, React.createElement(Wrench, { size: 40 })),
                            React.createElement('h3', { className: "text-2xl font-bold text-stone-800 dark:text-stone-100" }, "En desarrollo :P"),
                            React.createElement('p', { className: "text-stone-400 dark:text-stone-500 font-medium" }, "Pronto podrás configurar más opciones de tu inventario aquí.")
                        ]),
                        React.createElement('button', { onClick: closeSettingsAnimated, className: "mt-8 w-full py-4 px-6 rounded-2xl bg-stone-100 dark:bg-stone-800 text-stone-600 dark:text-stone-300 font-bold hover:bg-stone-200 dark:hover:bg-stone-700 transition-all duration-300 active:scale-95" }, "Entendido")
                    ])
                ])
            ]);
        }

        const root = createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
    </script>
</body>
</html>
